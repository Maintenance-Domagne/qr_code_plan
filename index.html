<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>Documents par machine</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body { font-family: Arial, sans-serif; background: #f4f6f8; padding: 20px; }
h1 { color: #2c3e50; }
h2 { color: #34495e; margin-top: 20px; }
h3 { color: #2c3e50; margin-top: 10px; }
ul { list-style: none; padding-left: 0; }
li { background: #ecf0f1; margin: 8px 0; padding: 10px; border-radius: 5px; }
a { text-decoration: none; color: #2980b9; font-weight: bold; }
a:hover { text-decoration: underline; }
.qr { margin: 10px 0; }
</style>
</head>
<body>

<h1>ğŸ“„ Embouteillage Ligne A</h1>
<div id="content">Chargement...</div>

<!-- QRCode.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>

<script>
const content = document.getElementById("content");
const params = new URLSearchParams(window.location.search);
const machineId = params.get("machine");

fetch("data.json")
  .then(res => {
    if (!res.ok) throw new Error("HTTP " + res.status + " â€“ data.json introuvable");
    return res.json();
  })
  .then(data => {
    if (!machineId) {
      // Aucune machine spÃ©cifiÃ©e â†’ afficher toutes les machines avec QR codes
      content.innerHTML = "<h2>Toutes les machines</h2>";

      for (const id in data) {
        const machine = data[id];

        const h3 = document.createElement("h3");
        h3.textContent = machine.label;
        content.appendChild(h3);

        const qrDiv = document.createElement("div");
        qrDiv.className = "qr";
        content.appendChild(qrDiv);

        // GÃ©nÃ©rer QR code pointant vers la machine
        new QRCode(qrDiv, {
          text: `${window.location.origin}${window.location.pathname}?machine=${id}`,
          width: 128,
          height: 128
        });

        // Lister les fichiers
        for (const folder in machine) {
          if (folder === "label") continue;
          const h4 = document.createElement("h4");
          h4.textContent = folder.replaceAll("_", " ");
          content.appendChild(h4);

          const ul = document.createElement("ul");
          machine[folder].forEach(item => {
            const li = document.createElement("li");
            li.innerHTML = `ğŸ“„ <a href="${item.file}" target="_blank">${item.name}</a>`;
            ul.appendChild(li);
          });
          content.appendChild(ul);
        }
      }

      return;
    }

    // Machine spÃ©cifiÃ©e â†’ afficher ses fichiers
    if (!data[machineId]) {
      content.innerHTML = "<p>âŒ Machine inconnue : " + machineId + "</p>";
      return;
    }

    const machine = data[machineId];
    content.innerHTML = `<h2>${machine.label}</h2>`;

    // QR code pour cette machine
    const qrDiv = document.createElement("div");
    qrDiv.className = "qr";
    content.appendChild(qrDiv);

    new QRCode(qrDiv, {
      text: `${window.location.href}`,
      width: 128,
      height: 128
    });

    for (const folder in machine) {
      if (folder === "label") continue;
      const h3 = document.createElement("h3");
      h3.textContent = folder.replaceAll("_", " ");
      content.appendChild(h3);

      const ul = document.createElement("ul");
      machine[folder].forEach(item => {
        const li = document.createElement("li");
        li.innerHTML = `ğŸ“„ <a href="${item.file}" target="_blank">${item.name}</a>`;
        ul.appendChild(li);
      });
      content.appendChild(ul);
    }
  })
  .catch(err => {
    console.error(err);
    content.innerHTML = "<p>âŒ ERREUR : " + err.message + "</p>";
  });
</script>

</body>
</html>














