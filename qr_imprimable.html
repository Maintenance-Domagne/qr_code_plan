<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>QR Codes Machines â€“ Embouteillage Ligne A</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
  font-family: Arial, sans-serif;
  padding: 20px;
}

h1 {
  text-align: center;
  margin-bottom: 20px;
}

button {
  display: block;
  margin: 0 auto 20px auto;
  padding: 10px 20px;
  font-size: 16px;
  cursor: pointer;
}

.page {
  page-break-after: always;
}

.grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 20px;
}

.machine {
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 12px;
  text-align: center;
  break-inside: avoid;
}

.machine h2 {
  font-size: 16px;
  margin: 0 0 10px 0;
}

.qr {
  margin: 0 auto 10px auto;
  width: 128px;
  height: 128px;
}

ul {
  list-style: none;
  padding: 0;
  margin: 0;
}

li {
  font-size: 12px;
  margin: 3px 0;
}

@media print {
  button { display: none; }
  body { padding: 0; }
}
</style>
</head>

<body>

<h1>QR Codes Machines â€“ Embouteillage Ligne A</h1>
<button id="exportPDF">ðŸ“„ Exporter en PDF</button>

<div id="container"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
/* ============================================================
   URL DE BASE (NE PAS TOUCHER)
============================================================ */
const BASE_URL = "https://maintenance-domagne.github.io/qr_code_plan/index.html";

/* ============================================================
   DONNÃ‰ES MACHINES
============================================================ */
const data = {
  "depalettiseur": { "label": "1- DÃ©palettiseur" },
  "decaisseuse": { "label": "2- DÃ©caisseuse" },
  "laveuse": { "label": "4- Laveuse" },
  "rinÃ§euse": { "label": "6- RinÃ§euse" },
  "soutireuse": { "label": "7- Soutireuse" },
  "boucheuse": { "label": "9- Boucheuse" },
  "visseuse_alu": { "label": "10- Visseuse alu" },
  "museleuse": { "label": "11- Museleuse" },
  "encaisseuse": { "label": "16- Encaisseuse" },
  "encartonneuse": { "label": "19- Encartonneuse" },
  "palettiseur": { "label": "21- Palettiseur" },
  "filmeuse": { "label": "22- Filmeuse" }
};

/* ============================================================
   GÃ‰NÃ‰RATION DES QR CODES (6 PAR PAGE)
============================================================ */
const container = document.getElementById("container");
const ids = Object.keys(data);
let page, grid;

ids.forEach((id, index) => {

  if (index % 6 === 0) {
    page = document.createElement("div");
    page.className = "page";

    grid = document.createElement("div");
    grid.className = "grid";

    page.appendChild(grid);
    container.appendChild(page);
  }

  const machine = document.createElement("div");
  machine.className = "machine";

  const h2 = document.createElement("h2");
  h2.textContent = data[id].label;
  machine.appendChild(h2);

  const qrDiv = document.createElement("div");
  qrDiv.className = "qr";
  machine.appendChild(qrDiv);

  new QRCode(qrDiv, {
    text: `${BASE_URL}?machine=${id}`,
    width: 128,
    height: 128
  });

  grid.appendChild(machine);
});

/* ============================================================
   EXPORT PDF MULTI-PAGES (PAS COUPÃ‰)
============================================================ */
document.getElementById("exportPDF").addEventListener("click", async () => {
  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF("p", "mm", "a4");

  const pages = document.querySelectorAll(".page");

  for (let i = 0; i < pages.length; i++) {
    const canvas = await html2canvas(pages[i], { scale: 2 });
    const imgData = canvas.toDataURL("image/png");

    const pageWidth = pdf.internal.pageSize.getWidth();
    const imgProps = pdf.getImageProperties(imgData);
    const imgHeight = (imgProps.height * pageWidth) / imgProps.width;

    if (i > 0) pdf.addPage();
    pdf.addImage(imgData, "PNG", 0, 0, pageWidth, imgHeight);
  }

  pdf.save("QR_Codes_Embouteillage_Ligne_A.pdf");
});
</script>

</body>
</html>
