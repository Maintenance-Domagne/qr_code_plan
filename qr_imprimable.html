<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<title>QR Codes Machines â€“ Embouteillage Ligne A</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<style>
body {
  font-family: Arial, sans-serif;
  padding: 20px;
}

h1 {
  text-align: center;
  margin-bottom: 20px;
}

button {
  display: block;
  margin: 0 auto 20px auto;
  padding: 10px 20px;
  font-size: 16px;
  cursor: pointer;
}

.grid {
  display: grid;
  grid-template-columns: 1fr 1fr;
  gap: 20px;
}

.machine {
  border: 1px solid #ccc;
  border-radius: 8px;
  padding: 12px;
  text-align: center;
}

.machine h2 {
  font-size: 16px;
  margin-bottom: 10px;
}

.qr {
  width: 128px;
  height: 128px;
  margin: 0 auto;
}

@media print {
  button { display: none; }
}
</style>
</head>

<body>

<h1>QR Codes Machines â€“ Embouteillage Ligne A</h1>
<button id="exportPDF">ðŸ“„ Exporter en PDF</button>

<div id="container" class="grid"></div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/qrcodejs/1.0.0/qrcode.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<script>
// ================= URL DE BASE =================
const BASE_URL = "https://maintenance-domagne.github.io/qr_code_plan/index.html";

// ================= DONNÃ‰ES =====================
const data = {
  "depalettiseur": { "label": "1- DÃ©palettiseur" },
  "decaisseuse": { "label": "2- DÃ©caisseuse" },
  "laveuse": { "label": "4- Laveuse" },
  "rinÃ§euse": { "label": "6- RinÃ§euse" },
  "soutireuse": { "label": "7- Soutireuse" },
  "boucheuse": { "label": "9- Boucheuse" },
  "visseuse_alu": { "label": "10- Visseuse alu" },
  "museleuse": { "label": "11- Museleuse" },
  "encaisseuse": { "label": "16- Encaisseuse" },
  "encartonneuse": { "label": "19- Encartonneuse" },
  "palettiseur": { "label": "21- Palettiseur" },
  "filmeuse": { "label": "22- Filmeuse" }
};

// ================= AFFICHAGE ====================
const container = document.getElementById("container");

Object.keys(data).forEach(id => {
  const div = document.createElement("div");
  div.className = "machine";

  const h2 = document.createElement("h2");
  h2.textContent = data[id].label;
  div.appendChild(h2);

  const qrDiv = document.createElement("div");
  qrDiv.className = "qr";
  div.appendChild(qrDiv);

  new QRCode(qrDiv, {
    text: `${BASE_URL}?machine=${id}`,
    width: 128,
    height: 128
  });

  container.appendChild(div);
});

// ================= EXPORT PDF ====================
document.getElementById("exportPDF").addEventListener("click", async () => {
  const { jsPDF } = window.jspdf;
  const pdf = new jsPDF("p", "mm", "a4");

  const machines = document.querySelectorAll(".machine");
  const perPage = 4;

  for (let i = 0; i < machines.length; i += perPage) {
    const page = document.createElement("div");
    page.className = "grid";
    page.style.padding = "20px";
    page.style.background = "white";

    machines.forEach((m, index) => {
      if (index >= i && index < i + perPage) {
        page.appendChild(m.cloneNode(true));
      }
    });

    document.body.appendChild(page);

    const canvas = await html2canvas(page, { scale: 2 });
    const imgData = canvas.toDataURL("image/png");

    const width = pdf.internal.pageSize.getWidth();
    const height = (canvas.height * width) / canvas.width;

    if (i > 0) pdf.addPage();
    pdf.addImage(imgData, "PNG", 0, 0, width, height);

    document.body.removeChild(page);
  }

  pdf.save("QR_Codes_Embouteillage_Ligne_A.pdf");
});
</script>

</body>
</html>
